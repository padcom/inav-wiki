This page will list and explain all the different navigational flight modes of iNav.

For safety reasons, iNAV’s navigation modes can be activated only if  
- ACC and MAG are calibrated properly,  
- you have a valid 3D GPS fix,   
- the FC is armed.  

This applies to enabling the navigation modes in the Configurator as well as at the flying field.   
(For bench tests without(!) propellers you may change “set nav_extra_arming_safety = ON” to “OFF” in CLI.)  
- Flightmodes like POSHOLD, WP (waypoints) and RTH (return to home) are self contained and don't need any additional modes to be defined in the “Modes” tab (… because ALTHOLD and ANGLE are activated together with these modes by iNAV automatically. Thus, ALTHOLD and ANGLE mode must be tuned correctly to make iNAV’s navigational modes work properly.)

- There is an companion [[wiki page further describing way point missions, tools and telemetry options|iNavFlight Missions]].

POSHOLD = 2D position hold  
POSHOLD + ALTHOLD = 3D position hold  
POSHOLD + ALTHOLD + MAG = 3D position hold and heading lock  
(ANGLE mode is automatically selected in all of the above.)

Note: All iNAV parameters for distance, velocity, and acceleration are input in  cm, cm/s and cm/s^2. 

Lets have a look at each mode of operation in detail.

## ALTHOLD - Altitude hold
When activated, the aircraft maintains its actual altitude unless changed by manual throttle input.
Throttle input indicate climb or sink up to a predetermined maximum rate (see CLI variables). Using ALTHOLD with a multicopter, you need a barometer. (A sonar may be added for adiitional functionality.) Using ALTHOLD with a plane with GPS, Barometer should be left alone. (To disable barometer: "set baro_hardware=1").

Using ALTHOLD with a multicopter:  
PIDs for altitude hold:  
- ALT P - defines how fast quad will attempt to compensate for altitude error (converts alt error to desired climb rate)  
- ALT I - defines how fast quad will accelerate to reach desired climb rate  
- VEL P - defined how much throttle quad will add to achieve desired acceleration  
- VEL I - controls compensation for hover throttle (and vertical air movement, thermals). This can essentially be zero if hover throttle is precisely 1500us. Too much VEL I will lead to vertical oscillations, too low VEL I will cause drops or jumps when ALTHOLD is switched on.  
- VEL D - acts as a dampener for VEL P and VEL I, will slower the response and reduce oscillations from too high VEL P and VEL I  

Inability to maintain altitude can be caused by a number of reasons:  
1.	insufficient ALT_P and/or ALT_I (on "official" cleanflight alt_i=0, that's why restoring old settings won’t work)  
2.	non-functional baro (please go to "settings" tab in configurator and verify that baro graph changes as you move the quad up and down  
3.	seriously under-powerd quad (althold is able to compensate only to some degree. if your quad hovers at 1700 linear throttle without any expo, althold might fail to compensate)  
4.	Gaining altitude during fast flight is likely due to increased air pressure and that is treated as going down in altitude - try covering your baro with (more) foam.

To deal with oscillations you can try lowering your VEL_P. 

Sonar: Altitude hold code will use sonar automatically on low altitudes (< 3m) if hardware is available.

Altitude, as calculated by iNAV's position estimator, is recorded to blackbox as navPos[2].


// TODO: explain remaining relevant settings

Activated by **ALTHOLD** flight mode.

## POSHOLD - Horizontal position hold
When activated, the quad/plane keeps its horizontal (2D) position, throttle still controls up and down movements (z-axis).
You can use your roll and pitch stick to move around. The position hold will be resumed when you center the roll/pitch stick again.      
Please note that you have to use this with **ALTHOLD** to get a full 3D position hold!  

// TODO: explain relevant settings.
// TODO: explain what happens when you are in POSHOLD mode and GPS fails.

Activated by **POSHOLD** flight mode.

## HEADING LOCK
This flight mode affects on yaw axis and can be enabled together with any other flight mode. 
It helps to maintain current heading without pilots input and  magnetometer's support. When yaw stick is neutral position, Heading Lock tries to keep total amount on rotation on yaw at zero. When pilot moves yaw stick, Heading Lock is not used.
It is a equivalent of [TauLabs Axis Lock mode](https://github.com/TauLabs/TauLabs/wiki/Flightmode-Settings#axislock) 

// TODO: explain if this works for FW w/o magnetometer.

## RTH - Return to home
RTH will attempt to bring copter/plane to launch position. Launch position is defined as a point where aircraft was ARMed. RTH Will control both position and altitude. You will have to manually control altitude if your aircraft does not have an altitude sensor (barometer). In the case of fixed wing, altitude comes from the GPS, so you dont need a barometer in your FC (CC3D for example).

With default settings RTH will land immediately if you are close than 5 meters from launch position. If further away it will make sure to have at least 10 meters of altitude, then start going home at 3m/s, and land. It will disarm itself if so configured, otherwise you will have to manually disarm once on the ground.

// TODO: explain how this works with planes.
// TODO: explain relevant settings.
// TODO: explain what happens when you are in RTH mode and GPS fails.

There are many different modes for Altitude, see [further down on this page](https://github.com/iNavFlight/inav/wiki/7.-Navigation-modes#rth-altitude-control-modes)

Activated by **RTH** flight mode.


## WP - Autonomous waypoint mission
Autonomous waypoints are used to let the quad/plane autonomous fly a predefined mission. The mission is defined with waypoints, which have the information about latitude, longitude, height and speed between the waypoints. GUIs such as EZ-GUI and mwp can be used to set the waypoints and upload the mission. Cleanflight or iNav configurator are still not capable of creating waypoint missions.  
Uploaded missions are saved in the FC until a reboot or a new uploaded mission erases the old one.  
  
Once the waypoint mode is activated (NAV WP has to be set previously in the mode tabs to a specific switch/value), the quad/plane will start to fly the waypoint mission based upon the waypoints in numerical order. Waypoint missions can be restarted by switching NAV WP off/on, interruption during the mission is also possible with switching NAV WP off. 

Currently up to 30 waypoints can be set on F1 boards, and 60 on F3 and better.

This mode is a work in progress, it does however work well. There is an additional [[wiki page further describing way point missions, tools and telemetry options|iNavFlight Missions]].

// TODO: Explain better.
// TODO: explain what happens when you are in WP mode and GPS fails.

## GCS_NAV - Ground control station
This mode is a work in progress. Used for follow-me etc.

// TODO: Explain better.
// TODO: explain what happens when you are in GSC NAV mode and GPS fails.
 
## Mode switch diagram

A diagram to indicate flight modes relation to navigation modes and illustrate sensor requirements:

![](images/nav_modes_diagram.jpg)

# RTH Altitude control modes

RTH sequence can control altitude in several different ways, controlled by **nav_rth_alt_mode** and **nav_rth_altitude** parameters.

Default setting is NAV_RTH_AT_LEAST_ALT - climb to preconfigured altitude if below, stay at current altitude if above.

## Maintain current altitude (NAV_RTH_NO_ALT)
nav_rth_alt_mode = CURRENT

nav_rth_altitude is ignored

![](images/NAV_RTH_NO_ALT.jpg)

## Maintain current altitude + predefined safety margin (NAX_RTH_EXTRA_ALT)
nav_rth_alt_mode = EXTRA

nav_rth_altitude defines extra altitude margin

![](images/NAX_RTH_EXTRA_ALT.jpg)

## Predefined altitude (NAV_RTH_CONST_ALT)
nav_rth_alt_mode = FIXED

nav_rth_altitude defines exact RTH altitude above launch point.

If the multi-rotor is below nav_rth_altitude it will enter position hold and climb to desired altitude prior to flying back home. If the machine is above the desired altitude, it will turn and fly home and descend on the way.

![](images/NAV_RTH_CONST_ALT.jpg)

## Maximum altitude since launch (NAV_RTH_MAX_ALT)
nav_rth_alt_mode = MAX

nav_rth_altitude is ignored

![](images/NAV_RTH_MAX_ALT.jpg)

## At least predefined altitude above launch point (NAV_RTH_AT_LEAST_ALT)
nav_rth_alt_mode = AT_LEAST

nav_rth_altitude defines exact RTH altitude above launch point

![](images/NAV_RTH_AT_LEAST_ALT.jpg)